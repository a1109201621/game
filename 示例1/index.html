<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Galgame</title>
  <link rel="stylesheet" href="style.css">
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script src="game.js"></script>
</head>

<body x-data="">
  <!-- 加载中状态 -->
  <div x-show="$store.game.loading" class="loading-container">
    <div class="loading-card">
      <div class="loading-spinner"></div>
      <p>正在初始化游戏...</p>
    </div>
  </div>

  <!-- 设置界面 -->
  <div x-show="!$store.game.started && !$store.game.loading" x-transition class="setup">
    <div class="card">
      <h1>💝 恋爱物语</h1>

      <div class="form-group">
        <label>你的名字：</label>
        <input x-model="$store.game.player_name" placeholder="请输入你的名字" />
      </div>

      <div class="form-group">
        <label>初始好感度：</label>
        <input type="range" x-model="$store.game.initial_affection" min="0" max="100" />
        <div class="range-display">
          <span>冷淡 (0)</span>
          <span class="badge" x-text="$store.game.initial_affection"></span>
          <span>热情 (100)</span>
        </div>
      </div>

      <div class="form-group">
        <label>初始关系：</label>
        <select x-model="$store.game.relationship">
          <option value="同学">同学</option>
          <option value="青梅竹马">青梅竹马</option>
          <option value="初次见面">初次见面</option>
          <option value="朋友">朋友</option>
          <option value="前辈后辈">前辈后辈</option>
        </select>
      </div>

      <button @click="$store.game.start()" :disabled="!$store.game.player_name">
        💖 开始游戏
      </button>

      <div class="instructions">
        <h3>游戏说明：</h3>
        <ul>
          <li>好感度会影响小樱对你的态度</li>
          <li>不同的选择会改变好感度</li>
          <li>达到100好感度会触发特殊剧情</li>
          <li>注意观察小樱的心情变化</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- 游戏界面 -->
  <div x-show="$store.game.started && !$store.game.loading" x-transition class="game"
    :data-time="$store.game.current_time">
    <!-- 状态栏 -->
    <div class="status-bar">
      <div class="affection">
        <span>💕 好感度</span>
        <div class="progress-bar">
          <div class="progress-fill" :style="`width: ${$store.game.current_affection || 0}%`"></div>
        </div>
        <span class="badge" x-text="$store.game.current_affection || 0"></span>
      </div>
      <div class="time">
        <span x-text="$store.game.current_time === '夜' ? '🌙' : '☀️'"></span>
        <span x-text="$store.game.current_time || '日'"></span>
      </div>
    </div>

    <!-- 角色立绘 -->
    <div class="character-area">
      <img
        :src="$store.game.character_image || 'https://opengameart.org/sites/default/files/illyustraciya_bez_nazvaniya_2.png'"
        :alt="$store.game.character_name" class="character-image" />
    </div>

    <!-- 对话框 -->
    <div class="dialogue">
      <div class="speaker" x-text="$store.game.character_name"></div>
      <div class="content" x-html="$store.game.chat_content || '对话加载中...'"></div>
    </div>

    <!-- 输入区域 -->
    <div class="input-area">
      <input x-model="$store.game.input" placeholder="输入你的回复..." :disabled="$store.game.disabled"
        @keydown.enter="$store.game.next()" />
      <button @click="$store.game.next()" :disabled="$store.game.disabled">发送</button>
    </div>
  </div>
</body>

</html>