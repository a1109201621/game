# 游戏开发 To-Do

> 首先阅读帮助文档.txt，然后参考示例1、示例2、示例3和独立游戏示例（如果用户有说明）进行游戏开发，并将游戏的文件存储在 `publish-{游戏名}` 文件夹中

---

## 核心功能

### 1. 存档系统（dzmm.kv）

- [ ] 实现手动存档/读档功能（3个存档位）
- [ ] 存档信息展示（时代、信仰、进步、时间戳）
- [ ] 存档数据结构设计（状态 + 历史对话上下文）
- [ ] localStorage 作为 kv API 的降级方案

### 2. 消息管理功能

- [ ] **编辑消息**：允许用户编辑任意历史消息
- [ ] **重新生成**：仅限最新一条 AI 回复可重新生成
- [ ] **删除消息**：允许删除任意消息（需确认提示）
- [ ] 操作后自动更新对话历史和 dzmm.chat

### 3. 主界面玩法说明

- [ ] 在设置界面添加完整玩法规则区块
- [ ] 包含：模式说明、信仰机制、进步点机制、战争规则、侦查功能
- [ ] 可折叠/展开的规则面板

### 4. 跳过加载页面

- [ ] 添加"跳过"按钮在加载页面
- [ ] 跳过后直接进入设置界面
- [ ] 设置合理的超时时间（如3秒后自动显示跳过按钮）

### 5. Debug 调试系统

- [ ] 浮动 Debug 按钮（网页最上层，可拖拽）
- [ ] **提示词收集**：记录每次发送给 AI 的完整 messages
- [ ] **响应收集**：记录每次 AI 返回的完整内容
- [ ] **错误捕获**：
  - API 调用失败
  - JSON 解析错误
  - 网络超时
  - SDK 初始化失败（卡在加载问题）
- [ ] Debug 面板：可查看/导出所有日志
- [ ] 一键复制日志功能

---

## 用户体验优化

### 6. 加载与反馈

- [ ] 加载状态优化（显示具体加载步骤）
- [ ] 操作按钮禁用状态的视觉反馈
- [ ] 长时间无响应的超时提示（如30秒）
- [ ] 网络断开检测与提示

### 7. 界面交互

- [ ] 消息输入框自动聚焦
- [ ] 快捷键支持（Enter 发送、Esc 关闭弹窗）
- [ ] 弹窗/抽屉点击外部关闭
- [ ] 滚动优化（新消息自动滚动到底部）

### 8. 响应式适配

- [ ] 移动端布局优化
- [ ] 触摸事件适配
- [ ] 小屏幕下的弹窗/抽屉尺寸调整

---

## 游戏功能增强

### 9. 对话系统

- [ ] 对话历史显示（可滚动查看之前的对话）
- [ ] 分支对话支持（基于 dzmm.chat 的树状结构）
- [ ] 对话导出功能

### 10. 状态可视化

- [ ] 信仰/进步的变化动画效果
- [ ] 时代推进的过场动画
- [ ] 战争结果的特效展示

### 11. 数据持久化

- [ ] 自动保存最近一次游戏状态
- [ ] 游戏退出前的保存提示
- [ ] 多设备同步（基于 dzmm.kv）

---

## 代码质量

### 12. 错误处理

- [ ] 全局错误边界
- [ ] API 调用的 try-catch 包装
- [ ] 用户友好的错误提示

### 13. 性能优化

- [ ] 大量对话历史的虚拟滚动
- [ ] 图片懒加载
- [ ] 防抖/节流处理

### 14. 代码结构

- [ ] 代码注释完善
- [ ] 函数职责单一化
- [ ] 常量/配置抽离

---

## 测试与部署

### 15. 测试

- [ ] 核心功能手动测试清单
- [ ] 边界情况测试（空输入、超长输入等）
- [ ] 不同模型的兼容性测试

### 16. 发布

- [ ] 确保 publish 目录结构正确
- [ ] 资源路径检查（相对路径）
- [ ] 发布前的最终测试
